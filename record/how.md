# 预处理
1. mid转xml
1. 读取xml，合并其中同一乐器演奏的部分
1. xml转pkl
1. 合并pkl，作为训练数据集

# 训练
对数据集进行分批训练，每次从数据集（音符序列）中随机取固定长度的片段，将其音高、力度、时长、间隔分别进行one-hot编码得到四个向量，连接成一个向量（four-hot），依次输入lstm中，将lstm的输出用softmax层变换为各种音高、力度、时长、间隔的一组概率，然后和下一个音符作交叉熵作为损失函数，将最小化该损失函数作为训练目标。
示意图如下：

# 生成
取一段音符序列作为初始序列，将其依次输入lstm，将输出仍然用softmax变换为一组概率，按照一定的规则进行取样（比如取概率值最大的，或者按照概率大小来随机取样，或者筛选概率在某个区间内随机取样），达到要求的长度后就停止取样，把结果转换为mid文件

# 调参玄学
需要调的参数主要有：
lstm层数
lstm层的大小
训练数据集的大小
批尺寸
取样方式

# 效果
网络规模大一些就会背曲，小一些输出就杂乱无章

# 下一步
我们还实现了一个神经网络（ValueNet）来对音符序列进行打分，由于时间关系还没有进行训练。
在达到我们制定的要求（略）后，将同时进行两种尝试：
1. 遗传算法，用ValueNet计算个体适应度
2. 将ValueNet作为损失函数的一部分训练作曲网络
